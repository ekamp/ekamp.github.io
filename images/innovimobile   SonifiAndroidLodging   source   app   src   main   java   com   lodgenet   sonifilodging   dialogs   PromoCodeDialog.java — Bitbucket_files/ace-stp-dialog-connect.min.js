var ace=ace||{};ace.stp=ace.stp||{},ace.stp.Initializer=function(a){"use strict";var b=!1;a(function(){ace.stp.Dialog.init(),ace.stp.Cache.getMessageFromCache().notify||ace.stp.Notification.sendMessageNotification(ace.stp.NotificationTypes.help),AP.require(["touch_point"],function(a){a.on("show",function(){b=ace.stp.Cache.getMessageFromCache().notify,ace.stp.Dialog.sendAceImpression()}),a.on("hide",function(){b&&ace.stp.Notification.sendMessageNotification(ace.stp.NotificationTypes.dismissedMessage)})})})}($);var ace=ace||{};ace.stp=ace.stp||{},ace.stp.Message=function(){"use strict";function a(){}function b(){}function c(){}return{bindMessageEvents:a,bindFeatureMessageEvent:b,sendFeatureMessageLoaded:c}}();var ace=ace||{};ace.stp=ace.stp||{},ace.stp.Notification=function(){"use strict";function a(a){var d=ace.stp.NotificationClasses[a],e=b(a);AP.require(["touch_point"],function(a){a.setIconClass(c+d),a.cacheIconClass(c+e)})}function b(a){return a===ace.stp.NotificationTypes.newMessage?ace.stp.NotificationClasses.message:a===ace.stp.NotificationTypes.dismissedMessage?ace.stp.NotificationClasses.help:ace.stp.NotificationClasses[a]}var c="aui-icon aui-icon-small ";return{sendMessageNotification:a}}();var ACE_STP_FEATURE_MSG_DIV_ID="ace-stp-message-feature",ACE_STP_FEATURE_MSG_LINK_ID="ace-stp-message-feature-link",ACE_STP_FEATURE_MSG_LINK_TARGET="ace-stp-link",ACE_STP_MINOR_MSG_LINK_1_ID="ace-stp-message-minor-1",ACE_STP_MINOR_MSG_LINK_2_ID="ace-stp-message-minor-2",ACE_STP_SEARCH_FORM_ID="ace-stp-search-form",BANNER_REGEX=/bannerid=(.*)&amp;campaignid/,CAMPAIGN_REGEX=/campaignid=(.*)&amp;zoneid/,ace=ace||{};ace.stp=ace.stp||{},ace.stp.Guid=function(){"use strict";function a(){return Math.guid()}function b(){return Math.guid().replace(/-/g,"")}return{guid:a,guidNoDashes:b}}();var ace=ace||{};ace.stp=ace.stp||{},ace.stp.MessageTypes={stpInitialized:"stp initialized",analyticsEvent:"analytics event",dialogOpened:"dialog opened",messageNotification:"message notification",featureLoaded:"feature loaded",lookAndFeel:"look and feel",atlPathEstablished:"atlPathEstablished"},ace.stp.NotificationTypes={help:"help",message:"message",newMessage:"newMessage",dismissedMessage:"dismissedMessage"},ace.stp.NotificationClasses={help:"ace-stp-icon-help",message:"ace-stp-icon-message",newMessage:"ace-stp-icon-message-new",dismissedMessage:"ace-stp-icon-message-dismiss"},ace.stp.AnalyticEventTypes={majorClick:"ace.stp.click.major",minorClick:"ace.stp.click.minor",search:"ace.stp.search",openStp:"ace.stp.open",openIcon:"ace.stp.open.icon",closeStp:"ace.stp.close"},ace.stp.AppTypes={JIRA:"JIRA",CONFLUENCE:"CONFLUENCE"};var ace=ace||{};ace.stp=ace.stp||{},ace.stp.StorageManager=function(){"use strict";var a="#",b=/\d+#/,c=function(a,b){this.prefix=a,this.id=b,this.namespace=this.prefix+"."+this.id;try{this.localStorageSupported="localStorage"in window&&null!==window.localStorage}catch(c){}};return c.prototype={getPrefix:function(b){var c=1e3*(b||0);return c?+new Date+c+a:""},getItem:function(a){if(!this.localStorageSupported)return null;var c=localStorage.getItem(this.namespace+"."+a),d=b.exec(c);return d===!0&&(c=c.replace(d[0],""),+new Date>d[0].replace("#",""))?(localStorage.removeItem(this.namespace+"."+a),null):c},contains:function(a){return!!this.getItem(a)},setItem:function(a,b,c){this.localStorageSupported&&(b=this.getPrefix(c)+b,localStorage.setItem(this.namespace+"."+a,b))},removeItem:function(a){this.localStorageSupported&&localStorage.removeItem(this.namespace+"."+a)}},{instance:c}}();var ace=ace||{};ace.stp=ace.stp||{},ace.stp.Cookie=function(){"use strict";function a(a,c){var d=b(a);return null!==d?d:c}function b(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null}function c(a,b,c,d){var e="";if(c){var f=new Date;f.setTime(f.getTime()+24*c*60*60*1e3),e="; expires="+f.toGMTString()}var g=a+"="+b+e+"; path=/;",h=window.location.hostname;if("localhost"!==h&&d===!0){var i=h.split(".");if(i.length>1){var j=i[i.length-1],k=i[i.length-2];(isNaN(j)||isNaN(k))&&(h="."+k+"."+j)}g+=" domain="+h+";"}document.cookie=g}return{getCookieUrl:a,readCookie:b,writeCookie:c}}();var ace=ace||{};ace.stp=ace.stp||{},ace.stp.Util=function(){"use strict";function a(){return ace.stp.Cookie.getCookieUrl(c,b)}var b=ACE_HOST+ACE_PATH+"?zoneid="+ACE_ZONE,c="ace.stp.dialog.jira.ace.url";return{getAceUrl:a}}();var ace=ace||{};ace.stp=ace.stp||{},ace.stp.Cache=function(){"use strict";function a(){e=new ace.stp.StorageManager.instance(f,g)}function b(){var a=JSON.parse(e.getItem(SM_KEY));return null===a&&(a={timestamp:null,html:null,beacon:null,notify:!1}),a}function c(a){e.setItem(SM_KEY,JSON.stringify(a))}function d(){e.removeItem(SM_KEY)}var e,f="com.atlassian",g="ace";return{init:a,getMessageFromCache:b,setMessageInCache:c,removeMessageFromCache:d}}();var ace=ace||{};ace.stp=ace.stp||{},ace.stp.Dialog=function(a){"use strict";function b(a,b){return null===a.timestamp||b-a.timestamp>q}function c(b,c){a.ajax({url:ace.stp.Util.getAceUrl(),dataType:"jsonp",contentType:"application/json",success:function(a){b.timestamp=c;var e=d(a);null!==e&&e.html!==b.html&&(b.html=e.html,b.beacon=e.beacon,b.notify=!0,ace.stp.Notification.sendMessageNotification(ace.stp.NotificationTypes.newMessage)),ace.stp.Cache.setMessageInCache(b),i()},error:function(a,b,c){console.log("ACE STP - Could not get banner from ACE: "+c)}})}function d(b){if(void 0===b.html||null===b.html||""===b.html)return null;try{var c=e(b.html),d=c[1],h=a(c[0]),i=f(h);return g(i.link,i.messageLink),{html:i.message[0].outerHTML,beacon:d}}catch(j){return null}}function e(a){var b="<div id='beacon_",c=a.split(b);if(2!==c.length)throw"No beacon or message in response";return c[1]=b+c[1],c}function f(a){var b=a.filter('a[target="'+ACE_STP_FEATURE_MSG_LINK_TARGET+'"]');if(0===b.length)throw"No link in response";var c=a.filter("div#"+ACE_STP_FEATURE_MSG_DIV_ID);if(0===c.length)throw"No message in response";var d=a.find("a#"+ACE_STP_FEATURE_MSG_LINK_ID);if(0===d.length)throw"No message link in response";return{link:b,message:c,messageLink:d}}function g(a,b){var c=a.attr("href").replace(/_cb=[A-Za-z0-9]+_/,"");b.attr("href",c)}function h(){var b=null,c=ace.stp.Cache.getMessageFromCache();if(null!==c.html&&null!==c.beacon){b=c.beacon.replace(/(referer=).*(&amp;)/,"$1"+encodeURIComponent(document.URL)+"$2"),b=b.replace(/(cb=).*(')/,"$1"+Math.floor(99999999999*Math.random())+"$2");var d=a(b);a("#"+ACE_STP_FEATURE_MSG_DIV_ID).append(d)}c.notify===!0&&(c.notify=!1,ace.stp.Cache.setMessageInCache(c))}function i(){var b=ace.stp.Cache.getMessageFromCache();if(null!==b.html&&null!==b.beacon){var c=a(b.html);j(c)&&k(c),a("#"+ACE_STP_FEATURE_MSG_DIV_ID).replaceWith(c),ace.stp.Message.bindFeatureMessageEvent(),ace.stp.Message.sendFeatureMessageLoaded(b),l(b),o()}}function j(a){return a.filter("#stp-message-feature").length>0}function k(a){a.filter("#stp-message-feature")[0].setAttribute("id",ACE_STP_FEATURE_MSG_DIV_ID),a.find("#stp-message-feature-image")[0].setAttribute("id","ace-stp-message-feature-image"),a.find("#stp-message-feature-link")[0].setAttribute("id",ACE_STP_FEATURE_MSG_LINK_ID)}function l(b){a("#"+ACE_STP_FEATURE_MSG_LINK_ID).addClass("aui-button aui-button-primary"),b.notify&&a("#"+ACE_STP_FEATURE_MSG_DIV_ID+" h1").after('<span class="aui-lozenge aui-lozenge-current new-indicator">NEW</span>')}function m(){ace.stp.Cache.init(),p=ace.stp.Cache.getMessageFromCache(),p.notify&&ace.stp.Notification.sendMessageNotification(ace.stp.NotificationTypes.message),b(p,r)?c(p,r):i(),ace.stp.Message.bindMessageEvents(),o()}function n(){a("#ace-stp-message-feature-link")[0].click()}function o(){a("#ace-stp-message-feature-image").on("click",n),a("#ace-stp-message-feature h1").on("click",n)}var p,q=864e5,r=(new Date).getTime();return{init:m,sendAceImpression:h}}($);